{% extends "base.html" %}
{% load humanize %}
{% block header %}
<link rel="stylesheet" href="../../static/bootstrap.min.css">
<link href="https://cdn.jsdelivr.net/npm/summernote@0.8.18/dist/summernote-bs4.min.css" rel="stylesheet">
<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/summernote@0.8.18/dist/summernote-bs4.min.js"></script>
<script>
  $(document).ready(function () {
    $('#id_contents').summernote({
      height: 300
    });
  });
</script>
{% endblock %}
{% load static %}
{% block contents %}
<div class="top">
  <div class="home_top">
    <a href="../../../"><img id='home_img' src="{% static 'images/logo.png' %}" alt="로고 이미지"></a>

    {% if request.session.user %}
    <div class="logout_align">
      <span class="badge bg-dark">
        <a class="top_menu" href="">마이 페이지</a>
      </span>
      <span class="badge bg-dark">
        <a class="top_menu" href="/logout/">로그아웃</a>
      </span>
    </div>
    {% else %}
    <div class="login_align">
      <span class="badge bg-dark">
        <a class="top_menu" href="/login/">로그인</a>
      </span>
      <span class="badge bg-dark">
        <a class="top_menu" href="/register/">회원가입</a>
      </span>
    </div>
    {% endif%}
  </div>
</div>
<div class="container mt-5">
  <div class="card border-primary mb-3">
    
      <div class="card-header">
        <h5 class="card-title">[{{ product.category }}] {{ product.name }}</h5>
        <p class="detail-date">조회수 : {{product.views}} / 찜 : {{product.jjim}} / 작성 일자 :
          {{product.register_date|date:'Y-m-d H:i'}}</p>
        <p class="detail-writer">판매자 : <a href="">{{product.writer.nickname|safe}}</a></p>
      
      <ul class="list-group list-group-flush">
        <li class="list-group-item">
          <form action="/order/create/" method="POST">
            {% csrf_token %}
            {% for field in form %}
            <div class="form-group">
              <!-- 상품설명(product)hidden 으로 설정 되었있으로 안보이도록 설정 -->
              {% if field.name != 'product' %}
              <label for="{{ field.id_for_label }}">{{ field.label }}</label>
              {% endif %}
              <input type="{{ field.field.widget.input_type }}" class="form-control" id="{{ field.id_for_label }}"
                placeholder="{{ field.label }}" name="{{ field.name }}"
                value="{% if field.name == 'product' %}{{product.id}}{% endif %}{% if field.name == 'quantity' %}1{% endif %}" />
            </div>
            {% if field.errors %}
            <span style="color: red">{{ field.errors }}</span>
            {% endif %}
            {% endfor %}
            <button type="submit" class="btn btn-primary" {% if product.stock <= 0 %}disabled{% endif %}>
              {% if product.stock > 0 %}
              주문하기
              {% else %}
              판매완료
              {% endif %}
            </button>

          </form>
        </li>
        <li class="list-group-item">가격: {{ product.price|intcomma }} 원</li>
        <li class="list-group-item">등록날짜: {{ product.register_date|date:'Y-m-d H:i' }}</li>
        <li class="list-group-item">재고: {{ product.stock|intcomma }} 개</li>
        <li class="list-group-item">{{ product.description|safe }}</li>
      </ul>
      
  
  {% if user == product.writer %}
  {% else %}
  <div class="text-center">
    {% if is_jjimed %}
      <a href="{% url 'product_jjim' pk=product.pk %}" class="btn btn-danger btn-vote-cancle">찜취소</a>
    {% else %}
      <a href="{% url 'product_jjim' pk=product.pk %}" class="btn btn-warning btn-vote-vote">찜하기</a>
    {% endif %}
  </div>
  {% endif %}
</div>
</div>

<div class="container mt-3 text-center">
  <button type="button" class="btn btn-primary" onclick="location.href='/sellboard/'">돌아가기</button>
  <button type="button" class="btn btn-warning"
    onclick="location.href='{% url 'product_update' product.id %}'">수정하기</button>
    <button type="submit" class="btn btn-danger", onclick="location.href='{% url 'product_delete' pk=product.pk %}'">삭제하기</button>
  <form id="delete-form" action="{% url 'product_detail' product.pk %}" method="post" style="display: none;">
    {% csrf_token %}
    <input type="hidden" name="delete" value="true">
  </form>
</div>
  
<div class="container mt-5">
  <div class="row justify-content-center">
    <div class="col-md-8">
      <div class="mt-3">
        <h4>댓글</h4>
        <ul class="list-group mt-3">
          {% for comment in comments %}
          <li class="list-group-item">
            <p>{{ comment.comment }}</p>
            <small class="text-muted">
              작성자: <a href="">{{ comment.author.nickname }}</a> | 작성일: {{ comment.created_at|date:'Y-m-d H:i' }}
            </small>
            <button type="button" class="btn btn-danger small-btn"
              onclick="location.href='/{{comment.id}}/k_comment_delete/'">삭제하기</button>
          </li>
          {% empty %}
          <li class="list-group-item">아직 댓글이 없습니다.</li>
          {% endfor %}
        </ul>
      </div>
      <div class="mt-3">
        <h4>댓글 작성</h4>
        <form method="post">
          {% csrf_token %}
          <input type="{{ comment_form.comment.field.widget.input_type }}" class="form-control"
            id="{{ comment_form.comment.id_for_label }}" placeholder="댓글 작성" name="{{ comment_form.comment.name }}"
            value="" />
          <button type="submit" class="btn btn-primary mt-2 comment-write">댓글 작성</button>
        </form>
      </div>
    </div>
  </div>
</div>
  {% endblock %}