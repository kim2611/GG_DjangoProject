{% extends "base.html" %}
{% load humanize %}
{% block header %}
<link rel="stylesheet" href="../../static/bootstrap.min.css">
<link href="https://cdn.jsdelivr.net/npm/summernote@0.8.18/dist/summernote-bs4.min.css" rel="stylesheet">
<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/summernote@0.8.18/dist/summernote-bs4.min.js"></script>
<script>
    $(document).ready(function () {
        $('#id_contents').summernote({
            height: 300
        });
    });
</script>
{% endblock %}
{% load static %}
{% block contents %}
<div class="top">
    <div class="home_top">
        <a href="../../../"><img id='home_img' src="{% static 'images/logo.png' %}" alt="로고 이미지"></a>

        {% if request.session.user %}
        <div class="logout_align">
            <span class="badge bg-dark">
                <a class="top_menu" href="/mypage/">마이 페이지</a>
            </span>
            <span class="badge bg-dark">
                <a class="top_menu" href="/logout/">로그아웃</a>
            </span>
        </div>
        {% else %}
        <div class="login_align">
            <span class="badge bg-dark">
                <a class="top_menu" href="/login/">로그인</a>
            </span>
            <span class="badge bg-dark">
                <a class="top_menu" href="/register/">회원가입</a>
            </span>
        </div>
        {% endif%}
    </div>
</div>
<div class="row mt-5">
    <div class="col-12">
        <div class="card" style="width: 100%;">
            <div class="card-body">
                <h5 class="card-title">[{{ buyproduct.category }}] {{ buyproduct.name }}</h5>
            </div>
            <ul class="list-group list-group-flush">
                <li class="list-group-item">희망가격: {{ buyproduct.price|intcomma }} 원</li>
                <li class="list-group-item">등록날짜: {{ buyproduct.register_date|date:'Y-m-d H:i' }}</li>
                <li class="list-group-item">{{ buyproduct.description|safe }}</li>
            </ul>
        </div>
    </div>
    <div class="row">
        <div class="container mt-3 text-center">
            <button type="button" class="btn btn-primary" onclick="location.href='/buyboard/'">돌아가기</button>
            <button type="button" class="btn btn-warning"
                onclick="location.href='{% url 'buyproduct_update' pk=buyproduct.pk %}'">수정하기</button>
            <button type="submit" class="btn btn-danger", onclick="location.href='{% url 'buyproduct_delete' pk=buyproduct.pk %}'">삭제하기</button>
            <form id="delete-form" action="{% url 'buyproduct_detail' buyproduct.pk %}" method="post"
                style="display: none;">
                {% csrf_token %}
                <input type="hidden" name="delete" value="true">
            </form>
        </div>
    </div>

    <div class="container mt-5">
        <div class="row justify-content-center">
            <div class="col-md-8">
                <div class="mt-3">
                    <h4>댓글</h4>
                    <ul class="list-group mt-3">
                        {% for comment in comments %}
                        <li class="list-group-item">
                            <p>{{ comment.comment }}</p>
                        <small class="text-muted">
                            작성자: <a href="">{{ comment.author.nickname }}</a> | 작성일: {{ comment.created_at|date:'Y-m-d H:i' }}
                        </small>
                            <button type="button" class="btn btn-danger small-btn"
                                onclick="location.href='/{{comment.id}}/comment_delete/'">삭제하기</button>
                        </li>
                        {% empty %}
                        <li class="list-group-item">아직 댓글이 없습니다.</li>
                        {% endfor %}
                    </ul>
                </div>

                <div class="mt-3">
                    <h4>댓글 작성</h4>
                    <form method="post">
                        {% csrf_token %}
                        <input type="{{ comment_form.comment.field.widget.input_type }}" class="form-control"
                            id="{{ comment_form.comment.id_for_label }}" placeholder="댓글 작성"
                            name="{{ comment_form.comment.name }}" value="" />

                        <button type="submit" class="btn btn-primary mt-2 comment-write">댓글 작성</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
    {% endblock %}